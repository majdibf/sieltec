
drop table sieltec.element_parcours;
drop table sieltec.evenement;
drop table sieltec.programme;
drop table sieltec.alerte;
drop table sieltec.parcours;
drop table sieltec.conducteur;
drop table sieltec.souscriptionalerte;
drop table sieltec.Ligne;
drop table sieltec.station;
drop table sieltec.vehicule;
drop table sieltec.type_evenement;
drop table sieltec.utilisateur;


drop schema SIELTEC restrict;
CREATE SCHEMA SIELTEC;

CREATE TABLE SIELTEC.CONDUCTEUR ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NOM                  VARCHAR( 50 ) NOT NULL,
	PRENOM               VARCHAR( 50 ) NOT NULL,
	CONTACT              VARCHAR( 20 ) NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_CONDUCTEUR PRIMARY KEY ( ID )
 );

CREATE TABLE SIELTEC.LIGNE ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NOM                  VARCHAR( 100 ) NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_LIGNE PRIMARY KEY ( ID )
 );

CREATE TABLE SIELTEC.PARCOURS ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NOM                  VARCHAR( 100 ) NOT NULL,
	ID_LIGNE             BIGINT NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_TRAJET PRIMARY KEY ( ID )
 );

CREATE INDEX IDX_TRAJET ON SIELTEC.PARCOURS ( ID_LIGNE );

CREATE TABLE SIELTEC.SOUSCRIPTIONALERTE ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	ADRESSE_MAIL         VARCHAR( 50 ),
	ID_LIGNE             BIGINT,
	CONSTRAINT PK_ABONNES PRIMARY KEY ( ID )
 );

CREATE INDEX idx_ABONNES ON SIELTEC.SOUSCRIPTIONALERTE ( ID_LIGNE );

CREATE TABLE SIELTEC.STATION ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NOM                  VARCHAR( 100 ) NOT NULL,
	LONGITUDE            VARCHAR( 30 ) NOT NULL,
	LATITUDE             VARCHAR( 30 ) NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_STATION PRIMARY KEY ( ID )
 );

CREATE TABLE SIELTEC.TYPE_EVENEMENT ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	LIBELLE              VARCHAR( 10 ) NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_TYPE_DETAIL_TOURNEE PRIMARY KEY ( ID )
 );

CREATE TABLE SIELTEC.VEHICULE ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	IMMATRICULATION      VARCHAR( 20 ) NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_VEHICULE PRIMARY KEY ( ID )
 );

CREATE TABLE SIELTEC.UTILISATEUR ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	LOGIN                VARCHAR( 50 ),
	PASSWORD             VARCHAR( 50 ),
	NOM                  VARCHAR( 50 ),
	PRENOM               VARCHAR( 50 ),
	CONSTRAINT PK_UTILISATEUR PRIMARY KEY ( ID )
 );

CREATE TABLE SIELTEC.ALERTE ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NOM                  VARCHAR( 50 ),
	DESCRIPTION          VARCHAR(5000),
	ID_PARCOURS          BIGINT,
	CONSTRAINT PK_ALERTE PRIMARY KEY ( ID )
 );

CREATE INDEX idx_ALERTE ON SIELTEC.ALERTE ( ID_PARCOURS );

CREATE TABLE SIELTEC.ELEMENT_PARCOURS ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	ID_PARCOURS          BIGINT NOT NULL,
	ID_STATION_DEP       BIGINT NOT NULL,
	ID_STATION_ARR       BIGINT NOT NULL,
	DUREE                BIGINT NOT NULL,
	DUREE_ARRET          BIGINT NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_ELEMENT_TRAJET PRIMARY KEY ( ID )
 );

CREATE INDEX IDX_ELEMENT_TRAJET ON SIELTEC.ELEMENT_PARCOURS ( ID_PARCOURS );

CREATE INDEX IDX_ELEMENT_TRAJET_0 ON SIELTEC.ELEMENT_PARCOURS ( ID_STATION_DEP );

CREATE INDEX IDX_ARRET ON SIELTEC.ELEMENT_PARCOURS ( ID_STATION_ARR );

CREATE TABLE SIELTEC.PROGRAMME ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	DATE_HEURE_DEBUT     TIMESTAMP NOT NULL,
	ID_PARCOURS          BIGINT,
	ID_VEHICULE          BIGINT NOT NULL,
	ID_CONDUCTEUR        BIGINT NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_PARCOURS PRIMARY KEY ( ID )
 );

CREATE INDEX IDX_PARCOURS ON SIELTEC.PROGRAMME ( ID_PARCOURS );

CREATE INDEX IDX_PARCOURS_0 ON SIELTEC.PROGRAMME ( ID_VEHICULE );

CREATE INDEX IDX_PARCOURS_1 ON SIELTEC.PROGRAMME ( ID_CONDUCTEUR );

CREATE TABLE SIELTEC.EVENEMENT ( 
	ID                   BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	ID_PROGRAMME         BIGINT NOT NULL,
	ID_STATION           BIGINT NOT NULL,
	ID_TYPE_EVENEMENT    BIGINT NOT NULL,
	DATE_HEURE           TIMESTAMP NOT NULL,
	VERSION              INT DEFAULT 0,
	CONSTRAINT PK_SUIVI_TOURNEE PRIMARY KEY ( ID )
 );

CREATE INDEX IDX_SUIVI_TOURNEE ON SIELTEC.EVENEMENT ( ID_PROGRAMME );

CREATE INDEX IDX_DETAIL_TOURNEE_REALISEE ON SIELTEC.EVENEMENT ( ID_STATION );

CREATE INDEX IDX_DETAIL_TOURNEE_REALISEE_0 ON SIELTEC.EVENEMENT ( ID_TYPE_EVENEMENT );

ALTER TABLE SIELTEC.ALERTE ADD CONSTRAINT FK_ALERTE_LIGNE FOREIGN KEY ( ID_PARCOURS ) REFERENCES SIELTEC.PARCOURS( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.ELEMENT_PARCOURS ADD CONSTRAINT FK_ELEMENT_PARCOURS__PARCOURS FOREIGN KEY ( ID_PARCOURS ) REFERENCES SIELTEC.PARCOURS( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.ELEMENT_PARCOURS ADD CONSTRAINT FK_ELEMENT_PARCOURS__STATION_DEP FOREIGN KEY ( ID_STATION_DEP ) REFERENCES SIELTEC.STATION( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.ELEMENT_PARCOURS ADD CONSTRAINT FK_ELEMENT_PARCOURS__STATION_ARR FOREIGN KEY ( ID_STATION_ARR ) REFERENCES SIELTEC.STATION( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.EVENEMENT ADD CONSTRAINT FK_DETAIL_TOURNEE_REALISEE__TOURNEE_PROGRAMMEE FOREIGN KEY ( ID_PROGRAMME ) REFERENCES SIELTEC.PROGRAMME( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.EVENEMENT ADD CONSTRAINT FK_DETAIL_TOURNEE_REALISEE__TYPE_DETAIL_TOURNEE FOREIGN KEY ( ID_TYPE_EVENEMENT ) REFERENCES SIELTEC.TYPE_EVENEMENT( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.EVENEMENT ADD CONSTRAINT FK_EVENEMENT__STATION FOREIGN KEY ( ID_STATION ) REFERENCES SIELTEC.STATION( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.PARCOURS ADD CONSTRAINT FK_PARCOURS__LIGNE FOREIGN KEY ( ID_LIGNE ) REFERENCES SIELTEC.LIGNE( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.PROGRAMME ADD CONSTRAINT FK_PROGRAMME__VEHICULE FOREIGN KEY ( ID_VEHICULE ) REFERENCES SIELTEC.VEHICULE( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.PROGRAMME ADD CONSTRAINT FK_PROGRAMME__CONDUCTEUR FOREIGN KEY ( ID_CONDUCTEUR ) REFERENCES SIELTEC.CONDUCTEUR( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.PROGRAMME ADD CONSTRAINT FK_PROGRAMME__PARCOURS FOREIGN KEY ( ID_PARCOURS ) REFERENCES SIELTEC.PARCOURS( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE SIELTEC.SOUSCRIPTIONALERTE ADD CONSTRAINT FK_ABONNES_LIGNE FOREIGN KEY ( ID_LIGNE ) REFERENCES SIELTEC.LIGNE( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;

